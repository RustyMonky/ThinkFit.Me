<!-- Facebook's Javascript SDK -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=566319116815288&version=v2.0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<% if @user.height.nil? or @user.weight.nil? %>
  <%= render 'facebooklog' %>
<% else %>

<div class="content">

  <!-- Facebook Share plugin -->
  <div class="fb-share-button" data-href="http://localhost:3000" data-width="50" data-type="button"></div>

  <!-- Twitter Tweet plugin -->
  <a href="https://twitter.com/share" class="twitter-share-button" data-via="IanCantor2">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <div class="span4">
    <section class="widget">
    <header>
    <legend><h4>
        Track your Activities
    </h4></legend>
    </header>

    <div class = "body">
      <% @user.goals.order('created_at DESC')[0..2].each do |goal| %>
        <% if goal.status == "active" %>
        <section class="widget">
          <div class="row-fluid">
            <div class="span4">
                <img src="" alt="64x64" style="height: 100px; width:100px;" data-placement="top" id="tooltip-enabled" data-original-title="" class="img-circle">
              </div>
            <div class="span8">
              <div class="span10">
                <h4 class="no-margin"><%= goal.name_of_activity_through_goal %> (<%= goal.total_points_per_goal %>)</h4>
              </div>
              <div class="span2">
                <%= button_to "+", new_user_goal_activity_log_path(current_user, goal), :class => "btn btn-success pull-top", :method => :get %>
                <%= button_to "-", edit_user_goal_path(current_user, goal), :class => "btn btn-danger pull-top", :method => :get %>
                <br>
              </div>
              <address>
                Goal: <%= goal.weekly_goal %> times/week<br>
                Logged: <%= goal.count_activity_log %> times<br>
                Latest Points: 
                <% if ActivityLog.where(goal_id: goal.id).length > 0 %>
                  <%= ActivityLog.where(goal_id: goal.id).last.points %>
                <% end %> <br>
                Last Logged: <%= goal.updated_at.to_s(:just_date) %>
              </address>
            </div>
          </div>
        </section>
        <% else %>
        <% end %>
      <% end %>
    </div>
      <%= button_to "Add new Goal", new_user_goal_path(current_user), :class => "btn btn-success span6 offset3", :method => :get %>
    </section>
  </div> 

  <div class="span4">
    <section class="widget chat companywall">
    <header>
    <legend><h4>
        Wall
    </h4></legend>
    </header>
    <div class="body">
      <div id="chat" class="chat">
        <div class="row-fluid non-responsive">
          <%= render "/comments/new" %>
        </div>
        <br>
        <div id="chat-messages" class="chat-messages">
          <%= render "/comments/each" %>
          <%= paginate @comments %>
        </div>
      </div>
    </div>
    </section>
  </div>

  <div class="span4">
    <section class="widget">
    <header>
    <legend><h4>
        Teams
    </h4></legend>
    </header>

    <section class="widget">
    I own teams:
    <ul>
      <% Team.where(owner_id: @commentable.id).each do |team| %>
        <li> <%= link_to team.name, team_path(team.id) %></li>
      <% end %>
    </ul>
    </section>
    <section class="widget">
    I'm a member of teams: 
    <ul>
      <% @commentable.teams.each do |team| %>
        <li> <%= link_to team.name, team_path(team.id) %></li>
      <% end %>
    </ul>

    <%= button_to "Create a Team",  new_team_path(@commentable.id), :class => "btn btn-success span6 offset3", :method => :get  %>
    </section>

  </div>

  <div class="span4">
    <section class="widget chat companywall">
    <header>
    <legend><h4>
        Activity Stats 
    </h4></legend>
    </header>
    <div class="body">
      <div id="chat" class="chat">
        <div id="stat-message" class="stats">
          HI! More information to come.
          <br/>
          <br>
          <% current_user.goals.each do |goal| %>
            <%= goal.name_of_activity_through_goal %>
            <br/> 
            <li> Since: </li>
            <li> Logged:  </li>
            <li> Total Duration: </li>
            <li> Total Distance: </li>
            <br/>
          <% end %>
        </div>
      </div>
    </div>
    </section>
  </div>

  <div class="span4">
    <section class="widget">
      <header>
        <legend><h4>
          Activity Logs
        </h4></legend>
      </header>
      <div class="body">
        <div id="actlogs">
          <% @user.goals.each do |goal| %>
            <% goal.activity_logs.each do |log| %>
              <br>
              <%= goal.name_of_activity_through_goal %>
              <li> Duration: <%= log.duration %></li>
              <% if log.intensity != nil %>
                <li> Intensity: <%= log.intensity %></li>
              <% end %>
              <% if log.distance != nil %>
                <li> Distance: <%= log.distance %></li>
              <% end %>
              <li> Points: <%= log.points %></li>
              <li> Logged: <%= log.created_at.to_s(:just_date) %></li>
              <% if log == goal.activity_logs.last %>
                <%= button_to "Remove Log", user_goal_activity_log_path(current_user, goal, log.id), :class => 'btn btn-danger', method: :delete %>
              <% end %>
              <br>
            <% end %>
          <% end %>
        </div>
      </div>
    </section>
  </div>

  <div class="span4">
    <section class="widget">
      <header>
      <legend>
        <h4> Friends  </h4>
        <%= link_to "+Add", friendship_path %>
      </legend>
      </header>
      <div class="body">
        <div id="friends" class="friends">
          <%= render partial: "friendships/friends", locals: { person_type: 'friend' } %>
        </div>
      </div>
    </section>
  </div>

  <div class="span4">
    <section class="widget">
      <header>
      <legend>
        <h4> Followers</h4>
      </legend>
      </header>
      <div class="body">
        <div id="followers" class="followers">
          <%= render partial: "friendships/friends", locals: { person_type: 'follower' } %>
        </div>
      </div>
    </section>
  </div>

  <!-- This'll have to be reformatted. Have it here to verify if image upload works -->
  <div class="uploadertest">
    <%= image_tag current_user.avatar_url %>
  </div>
</div>
<% end %>
